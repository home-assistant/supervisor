"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[8328],{88328:function(e,t,a){a.r(t);var s,i,n,r,o,c,u=a(88962),l=a(99312),d=a(81043),h=a(33368),p=a(71650),k=a(82390),b=a(69205),g=a(70906),m=a(91808),v=(a(44577),a(68144)),f=a(79932),_=a(63864),y=a(47181),x=a(32594),w=a(83447),Z=(a(34821),a(98762),a(9381),a(81545),a(90806),a(5666),a(22814)),P=a(60538),A=a(41682),C=a(26765),L=a(11654),B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=document.createElement("a");a.target="_blank",a.href=e,a.download=t,document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click")),document.body.removeChild(a)};a(35919),(0,m.Z)([(0,f.Mo)("dialog-hassio-backup")],(function(e,t){var a,m,O,T,R,D,S=function(t){(0,b.Z)(s,t);var a=(0,g.Z)(s);function s(){var t;(0,p.Z)(this,s);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),e((0,k.Z)(t)),t}return(0,h.Z)(s)}(t);return{F:S,d:[{kind:"field",decorators:[(0,f.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,f.SB)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,f.SB)()],key:"_backup",value:void 0},{kind:"field",decorators:[(0,f.SB)()],key:"_dialogParams",value:void 0},{kind:"field",decorators:[(0,f.SB)()],key:"_restoringBackup",value:function(){return!1}},{kind:"field",decorators:[(0,f.IO)("supervisor-backup-content")],key:"_backupContent",value:void 0},{kind:"method",key:"showDialog",value:(D=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,P._P)(this.hass,t.slug);case 2:this._backup=e.sent,this._dialogParams=t,this._restoringBackup=!1;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{kind:"method",key:"closeDialog",value:function(){this._backup=void 0,this._dialogParams=void 0,this._restoringBackup=!1,this._error=void 0,(0,y.B)(this,"dialog-closed",{dialog:this.localName})}},{kind:"method",key:"render",value:function(){var e,t,a;return this._dialogParams&&this._backup?(0,v.dy)(s||(s=(0,u.Z)([' <ha-dialog open scrimClickAction @closed="','" .heading="','"> <div slot="heading"> <ha-header-bar> <span slot="title">','</span> <ha-icon-button .label="','" .path="','" slot="actionItems" dialogAction="cancel"></ha-icon-button> </ha-header-bar> </div> '," ",' <mwc-button .disabled="','" slot="secondaryAction" @click="','"> Restore </mwc-button> '," </ha-dialog> "])),this.closeDialog,this._backup.name,this._backup.name,(null===(e=this.hass)||void 0===e?void 0:e.localize("ui.common.close"))||"Close","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",this._restoringBackup?(0,v.dy)(i||(i=(0,u.Z)([" <ha-circular-progress active></ha-circular-progress>"]))):(0,v.dy)(n||(n=(0,u.Z)(['<supervisor-backup-content .hass="','" .supervisor="','" .backup="','" .onboarding="','" .localize="','" dialogInitialFocus> </supervisor-backup-content>'])),this.hass,this._dialogParams.supervisor,this._backup,this._dialogParams.onboarding||!1,this._dialogParams.localize),this._error?(0,v.dy)(r||(r=(0,u.Z)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):"",this._restoringBackup,this._restoreClicked,this._dialogParams.onboarding?"":(0,v.dy)(o||(o=(0,u.Z)(['<ha-button-menu fixed slot="primaryAction" @action="','" @closed="','"> <ha-icon-button .label="','" .path="','" slot="trigger"></ha-icon-button> <mwc-list-item>','</mwc-list-item> <mwc-list-item class="error">',"</mwc-list-item> </ha-button-menu>"])),this._handleMenuAction,x.U,this.hass.localize("ui.common.menu")||"Menu","M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",null===(t=this._dialogParams.supervisor)||void 0===t?void 0:t.localize("backup.download_backup"),null===(a=this._dialogParams.supervisor)||void 0===a?void 0:a.localize("backup.delete_backup_title"))):v.Ld}},{kind:"get",static:!0,key:"styles",value:function(){return[L.Qx,L.yu,(0,v.iv)(c||(c=(0,u.Z)(["ha-circular-progress{display:block;text-align:center}ha-header-bar{--mdc-theme-on-primary:var(--primary-text-color);--mdc-theme-primary:var(--mdc-theme-surface);flex-shrink:0;display:block}ha-icon-button{color:var(--secondary-text-color)}"])))]}},{kind:"method",key:"_handleMenuAction",value:function(e){switch(e.detail.index){case 0:this._downloadClicked();break;case 1:this._deleteClicked()}}},{kind:"method",key:"_restoreClicked",value:(R=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._backupContent.backupDetails(),this._restoringBackup=!0,"full"!==this._backupContent.backupType){e.next=7;break}return e.next=5,this._fullRestoreClicked(t);case 5:e.next=9;break;case 7:return e.next=9,this._partialRestoreClicked(t);case 9:this._restoringBackup=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{kind:"method",key:"_partialRestoreClicked",value:(T=(0,d.Z)((0,l.Z)().mark((function e(t){var a,s,i,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(null===(a=this._dialogParams)||void 0===a?void 0:a.supervisor)||"running"===(null===(s=this._dialogParams)||void 0===s?void 0:s.supervisor.info.state)){e.next=4;break}return e.next=3,(0,C.Ys)(this,{title:"Could not restore backup",text:"Restoring a backup is not possible right now because the system is in ".concat(null===(n=this._dialogParams)||void 0===n?void 0:n.supervisor.info.state," state.")});case 3:return e.abrupt("return");case 4:return e.next=6,(0,C.g7)(this,{title:"Are you sure you want partially to restore this backup?",confirmText:"restore",dismissText:"cancel"});case 6:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:if(null!==(i=this._dialogParams)&&void 0!==i&&i.onboarding){e.next=20;break}return e.prev=9,e.next=12,this.hass.callApi("POST","hassio/".concat((0,_.I)(this.hass.config.version,2021,9)?"backups":"snapshots","/").concat(this._backup.slug,"/restore/partial"),t);case 12:this.closeDialog(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),this._error=e.t0.body.message;case 18:e.next=24;break;case 20:return(0,y.B)(this,"restoring"),e.next=23,fetch("/api/hassio/backups/".concat(this._backup.slug,"/restore/partial"),{method:"POST",body:JSON.stringify(t)});case 23:this.closeDialog();case 24:case"end":return e.stop()}}),e,this,[[9,15]])}))),function(e){return T.apply(this,arguments)})},{kind:"method",key:"_fullRestoreClicked",value:(O=(0,d.Z)((0,l.Z)().mark((function e(t){var a,s,i,n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(null===(a=this._dialogParams)||void 0===a?void 0:a.supervisor)||"running"===(null===(s=this._dialogParams)||void 0===s?void 0:s.supervisor.info.state)){e.next=4;break}return e.next=3,(0,C.Ys)(this,{title:"Could not restore backup",text:"Restoring a backup is not possible right now because the system is in ".concat(null===(n=this._dialogParams)||void 0===n?void 0:n.supervisor.info.state," state.")});case 3:return e.abrupt("return");case 4:return e.next=6,(0,C.g7)(this,{title:"Are you sure you want to wipe your system and restore this backup?",confirmText:"restore",dismissText:"cancel"});case 6:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:null!==(i=this._dialogParams)&&void 0!==i&&i.onboarding?((0,y.B)(this,"restoring"),fetch("/api/hassio/backups/".concat(this._backup.slug,"/restore/full"),{method:"POST",body:JSON.stringify(t)}),this.closeDialog()):this.hass.callApi("POST","hassio/".concat((0,_.I)(this.hass.config.version,2021,9)?"backups":"snapshots","/").concat(this._backup.slug,"/restore/full"),t).then((function(){r.closeDialog()}),(function(e){r._error=e.body.message}));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{kind:"method",key:"_deleteClicked",value:(m=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C.g7)(this,{title:"Are you sure you want to delete this backup?",confirmText:"delete",dismissText:"cancel"});case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,(0,P.FZ)(this.hass,this._backup.slug);case 7:this._dialogParams.onDelete&&this._dialogParams.onDelete(),this.closeDialog(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),this._error=e.t0.body.message;case 14:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(){return m.apply(this,arguments)})},{kind:"method",key:"_downloadClicked",value:(a=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,Z.iI)(this.hass,"/api/hassio/".concat((0,_.I)(this.hass.config.version,2021,9)?"backups":"snapshots","/").concat(this._backup.slug,"/download"));case 3:t=e.sent,e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(0),e.next=10,(0,C.Ys)(this,{text:(0,A.js)(e.t0)});case 10:return e.abrupt("return");case 11:if(!window.location.href.includes("ui.nabu.casa")){e.next=17;break}return e.next=14,(0,C.g7)(this,{title:"Potential slow download",text:"Downloading backups over the Nabu Casa URL will take some time, it is recomended to use your local URL instead, do you want to continue?",confirmText:"continue",dismissText:"cancel"});case 14:if(e.sent){e.next=17;break}return e.abrupt("return");case 17:B(t.path,"home_assistant_backup_".concat((0,w.l)(this._computeName),".tar"));case 18:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{kind:"get",key:"_computeName",value:function(){return this._backup?this._backup.name||this._backup.slug:"Unnamed backup"}}]}}),v.oi)},32594:function(e,t,a){a.d(t,{U:function(){return s}});var s=function(e){return e.stopPropagation()}},83447:function(e,t,a){a.d(t,{l:function(){return s}});var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",a="àáäâãåăæąçćčđďèéěėëêęğǵḧìíïîįłḿǹńňñòóöôœøṕŕřßşśšșťțùúüûǘůűūųẃẍÿýźžż·/_,:;",s="aaaaaaaaacccddeeeeeeegghiiiiilmnnnnooooooprrsssssttuuuuuuuuuwxyyzzz".concat(t).concat(t).concat(t).concat(t).concat(t).concat(t),i=new RegExp(a.split("").join("|"),"g");return e.toString().toLowerCase().replace(/\s+/g,t).replace(i,(function(e){return s.charAt(a.indexOf(e))})).replace(/&/g,"".concat(t,"and").concat(t)).replace(/[^\w-]+/g,"").replace(/-/g,t).replace(new RegExp("(".concat(t,")\\1+"),"g"),"$1").replace(new RegExp("^".concat(t,"+")),"").replace(new RegExp("".concat(t,"+$")),"")}},22814:function(e,t,a){a.d(t,{iI:function(){return i},oT:function(){return s}});"".concat(location.protocol,"//").concat(location.host);var s=function(e){return e.map((function(e){if("string"!==e.type)return e;switch(e.name){case"username":return Object.assign(Object.assign({},e),{},{autocomplete:"username"});case"password":return Object.assign(Object.assign({},e),{},{autocomplete:"current-password"});case"code":return Object.assign(Object.assign({},e),{},{autocomplete:"one-time-code"});default:return e}}))},i=function(e,t){return e.callWS({type:"auth/sign_path",path:t})}}}]);
//# sourceMappingURL=8328-ckQ7Pj0u2ns.js.map