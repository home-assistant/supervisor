"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["8563"],{69064:function(e,t,s){var i=s(73577),a=s(72621),o=(s(19083),s(71695),s(40251),s(47021),s(57243)),n=s(50778),r=s(36522),d=s(83523),l=s(58776),h=s(76320),c=(s(23043),s(66899)),u=s(56785),p=s(17803);function v(e){return document.cookie=`ingress_session=${e};path=/api/hassio_ingress/;SameSite=Strict${"https:"===location.protocol?";Secure":""}`,e}const g=async e=>{if((0,p.I)(e.config.version,2021,2,4)){return v((await e.callWS({type:"supervisor/api",endpoint:"/ingress/session",method:"post"})).session)}return v((await e.callApi("POST","hassio/ingress/session")).data.session)};var _=s(76131);s(75375),s(87979);let m,f,y,w,k,b,x=e=>e;(0,i.Z)([(0,n.Mo)("hassio-ingress-view")],(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"supervisor",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"route",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"ingressPanel",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"narrow",value(){return!1}},{kind:"field",decorators:[(0,n.SB)()],key:"_addon",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_loadingMessage",value:void 0},{kind:"field",key:"_sessionKeepAlive",value:void 0},{kind:"field",key:"_fetchDataTimeout",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,a.Z)(s,"disconnectedCallback",this,3)([]),this._sessionKeepAlive&&(clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=void 0),this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0)}},{kind:"method",key:"render",value:function(){if(!this._addon)return(0,o.dy)(m||(m=x`<hass-loading-screen .message="${0}"></hass-loading-screen>`),this._loadingMessage);const e=(0,o.dy)(f||(f=x`<iframe title="${0}" src="${0}" @load="${0}"> </iframe>`),this._addon.name,this._addon.ingress_url,this._checkLoaded);return this.ingressPanel?(0,o.dy)(w||(w=x`${0}`),this.narrow||"always_hidden"===this.hass.dockedSidebar?(0,o.dy)(k||(k=x`<div class="header"> <ha-icon-button .label="${0}" .path="${0}" @click="${0}"></ha-icon-button> <div class="main-title">${0}</div> </div> ${0}`),this.hass.localize("ui.sidebar.sidebar_toggle"),"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z",this._toggleMenu,this._addon.name,e):e):(0,o.dy)(y||(y=x`<hass-subpage .hass="${0}" .header="${0}" .narrow="${0}"> ${0} </hass-subpage>`),this.hass,this._addon.name,this.narrow,e)}},{kind:"method",key:"firstUpdated",value:async function(){if(""===this.route.path){const t=(0,l.io)("addon");let s;if(t){try{s=await(0,c.AD)(this.hass,t)}catch(e){return await(0,_.Ys)(this,{text:(0,u.js)(e),title:t}),await(0,h.y)(),void(0,d.c)("/hassio/store",{replace:!0})}s.version?s.ingress?(0,d.c)(`/hassio/ingress/${s.slug}`,{replace:!0}):(await(0,_.Ys)(this,{text:this.supervisor.localize("my.error_addon_no_ingress"),title:s.name}),await(0,h.y)(),(0,d.c)(`/hassio/addon/${s.slug}/info`,{replace:!0})):(await(0,_.Ys)(this,{text:this.supervisor.localize("my.error_addon_not_installed"),title:s.name}),await(0,h.y)(),(0,d.c)(`/hassio/addon/${s.slug}/info`,{replace:!0}))}}}},{kind:"method",key:"willUpdate",value:function(e){if((0,a.Z)(s,"willUpdate",this,3)([e]),!e.has("route"))return;const t=this.route.path.substring(1),i=e.get("route"),o=i?i.path.substring(1):void 0;t&&t!==o&&(this._loadingMessage=void 0,this._fetchData(t))}},{kind:"method",key:"_fetchData",value:async function(e){const t=g(this.hass);let s,i;try{s=await(0,c.AD)(this.hass,e)}catch(a){return await this.updateComplete,await(0,_.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_info")||"Unable to fetch add-on info to start Ingress",title:"Supervisor"}),await(0,h.y)(),void(0,d.c)("/hassio/store",{replace:!0})}if(!s.version)return await this.updateComplete,await(0,_.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_not_installed")||"The add-on is not installed. Please install it first",title:s.name}),await(0,h.y)(),void(0,d.c)(`/hassio/addon/${s.slug}/info`,{replace:!0});if(!s.ingress_url)return await this.updateComplete,await(0,_.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_not_supported")||"This add-on does not support Ingress",title:s.name}),await(0,h.y)(),void history.back();if(!s.state||!["startup","started"].includes(s.state)){await this.updateComplete;if(!(await(0,_.g7)(this,{text:this.supervisor.localize("ingress.error_addon_not_running")||"The add-on is not running. Do you want to start it now?",title:s.name,confirmText:this.supervisor.localize("ingress.start_addon")||"Start add-on",dismissText:this.supervisor.localize("common.no")||"No"})))return await(0,h.y)(),void(0,d.c)(`/hassio/addon/${s.slug}/info`,{replace:!0});try{return this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",await(0,c.kP)(this.hass,e),(0,r.B)(this,"supervisor-collection-refresh",{collection:"addon"}),void this._fetchData(e)}catch(a){return await(0,_.Ys)(this,{text:this.supervisor.localize("ingress.error_starting_addon")||"Error starting the add-on",title:s.name}),await(0,h.y)(),void(0,d.c)(`/hassio/addon/${s.slug}/logs`,{replace:!0})}}if("startup"===s.state)return this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",void(this._fetchDataTimeout=window.setTimeout((()=>{this._fetchData(e)}),500));if("started"===s.state){this._loadingMessage=void 0,this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0);try{i=await t}catch(a){return this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),await(0,_.Ys)(this,{text:this.supervisor.localize("ingress.error_creating_session")||"Unable to create an Ingress session",title:s.name}),await(0,h.y)(),void history.back()}this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=window.setInterval((async()=>{try{await(async(e,t)=>{(0,p.I)(e.config.version,2021,2,4)?await e.callWS({type:"supervisor/api",endpoint:"/ingress/validate_session",method:"post",data:{session:t}}):await e.callApi("POST","hassio/ingress/validate_session",{session:t})})(this.hass,i)}catch(a){i=await g(this.hass)}}),6e4),this._addon=s}}},{kind:"method",key:"_checkLoaded",value:async function(e){this._addon&&"502: Bad Gateway"===e.target.contentDocument.body.textContent&&(await this.updateComplete,(0,_.g7)(this,{text:this.supervisor.localize("ingress.error_addon_not_ready")||"The add-on seems to not be ready, it might still be starting. Do you want to try again?",title:this._addon.name,confirmText:this.supervisor.localize("ingress.retry")||"Retry",dismissText:this.supervisor.localize("common.no")||"No",confirm:async()=>{const e=this._addon;this._addon=void 0,await Promise.all([this.updateComplete,new Promise((e=>{setTimeout(e,500)}))]),this._addon=e}}))}},{kind:"method",key:"_toggleMenu",value:function(){(0,r.B)(this,"hass-toggle-menu")}},{kind:"field",static:!0,key:"styles",value(){return(0,o.iv)(b||(b=x`iframe{display:block;width:100%;height:100%;border:0}.header+iframe{height:calc(100% - 40px)}.header{display:flex;align-items:center;font-size:16px;height:40px;padding:0 16px;pointer-events:none;background-color:var(--app-header-background-color);font-weight:400;color:var(--app-header-text-color,#fff);border-bottom:var(--app-header-border-bottom,none);box-sizing:border-box;--mdc-icon-size:20px}.main-title{margin:var(--margin-title);line-height:20px;flex-grow:1}ha-icon-button{pointer-events:auto}hass-subpage{--app-header-background-color:var(--sidebar-background-color);--app-header-text-color:var(--sidebar-text-color);--app-header-border-bottom:1px solid var(--divider-color)}`))}}]}}),o.oi)},58776:function(e,t,s){s.d(t,{Q2:()=>a,io:()=>o,ou:()=>n});s(71695),s(19134),s(11740),s(47706),s(39527),s(41360),s(47021),s(71513),s(75656),s(50100),s(18084);var i=s(14463);const a=()=>{const e={},t=new URLSearchParams(i.E.location.search);for(const[s,i]of t.entries())e[s]=i;return e},o=e=>new URLSearchParams(i.E.location.search).get(e),n=e=>{const t=new URLSearchParams;return Object.entries(e).forEach((([e,s])=>{t.append(e,s)})),t.toString()}}}]);
//# sourceMappingURL=8563.69ef4abcdd831bf3.js.map