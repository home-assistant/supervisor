"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["779"],{80390:function(t,e,s){s.a(t,async function(t,i){try{s.r(e);s(79827),s(35748),s(5934),s(95013);var a=s(69868),o=s(84922),r=s(11991),n=s(44017),d=s(77240),h=s(94372),l=s(54337),c=(s(64054),s(57608)),p=s(63625),u=s(51973),g=s(15241),_=s(70890),v=(s(41564),t([_]));_=(v.then?(await v)():v)[0];let m,f,w,y,b,$,x=t=>t;const k="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z";class T extends o.WF{disconnectedCallback(){super.disconnectedCallback(),this._sessionKeepAlive&&(clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=void 0),this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0)}render(){if(!this._addon)return(0,o.qy)(m||(m=x`<hass-loading-screen .message="${0}"></hass-loading-screen>`),this._loadingMessage);const t=(0,o.qy)(f||(f=x`<iframe title="${0}" src="${0}" @load="${0}"> </iframe>`),this._addon.name,this._addon.ingress_url,this._checkLoaded);return this.ingressPanel?(0,o.qy)(y||(y=x`${0}`),this.narrow||"always_hidden"===this.hass.dockedSidebar?(0,o.qy)(b||(b=x`<div class="header"> <ha-icon-button .label="${0}" .path="${0}" @click="${0}"></ha-icon-button> <div class="main-title">${0}</div> </div> ${0}`),this.hass.localize("ui.sidebar.sidebar_toggle"),k,this._toggleMenu,this._addon.name,t):t):(0,o.qy)(w||(w=x`<hass-subpage .hass="${0}" .header="${0}" .narrow="${0}"> ${0} </hass-subpage>`),this.hass,this._addon.name,this.narrow,t)}async firstUpdated(){if(""===this.route.path){const e=(0,h.p9)("addon");let s;if(e){try{s=await(0,c.wj)(this.hass,e)}catch(t){return await(0,g.K$)(this,{text:(0,p.VR)(t),title:e}),await(0,l.E)(),void(0,d.o)("/hassio/store",{replace:!0})}s.version?s.ingress?(0,d.o)(`/hassio/ingress/${s.slug}`,{replace:!0}):(await(0,g.K$)(this,{text:this.supervisor.localize("my.error_addon_no_ingress"),title:s.name}),await(0,l.E)(),(0,d.o)(`/hassio/addon/${s.slug}/info`,{replace:!0})):(await(0,g.K$)(this,{text:this.supervisor.localize("my.error_addon_not_installed"),title:s.name}),await(0,l.E)(),(0,d.o)(`/hassio/addon/${s.slug}/info`,{replace:!0}))}}}willUpdate(t){if(super.willUpdate(t),!t.has("route"))return;const e=this.route.path.substring(1),s=t.get("route"),i=s?s.path.substring(1):void 0;e&&e!==i&&(this._loadingMessage=void 0,this._fetchData(e))}async _fetchData(t){const e=(0,u.q)(this.hass);let s,i;try{s=await(0,c.wj)(this.hass,t)}catch(a){return await this.updateComplete,await(0,g.K$)(this,{text:this.supervisor.localize("ingress.error_addon_info")||"Unable to fetch add-on info to start Ingress",title:"Supervisor"}),await(0,l.E)(),void(0,d.o)("/hassio/store",{replace:!0})}if(!s.version)return await this.updateComplete,await(0,g.K$)(this,{text:this.supervisor.localize("ingress.error_addon_not_installed")||"The add-on is not installed. Please install it first",title:s.name}),await(0,l.E)(),void(0,d.o)(`/hassio/addon/${s.slug}/info`,{replace:!0});if(!s.ingress_url)return await this.updateComplete,await(0,g.K$)(this,{text:this.supervisor.localize("ingress.error_addon_not_supported")||"This add-on does not support Ingress",title:s.name}),await(0,l.E)(),void(0,d.O)();if(!s.state||!["startup","started"].includes(s.state)){await this.updateComplete;if(!(await(0,g.dk)(this,{text:this.supervisor.localize("ingress.error_addon_not_running")||"The add-on is not running. Do you want to start it now?",title:s.name,confirmText:this.supervisor.localize("ingress.start_addon")||"Start add-on",dismissText:this.supervisor.localize("common.no")||"No"})))return await(0,l.E)(),void(0,d.o)(`/hassio/addon/${s.slug}/info`,{replace:!0});try{return this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",await(0,c.eK)(this.hass,t),(0,n.r)(this,"supervisor-collection-refresh",{collection:"addon"}),void this._fetchData(t)}catch(a){return await(0,g.K$)(this,{text:this.supervisor.localize("ingress.error_starting_addon")||"Error starting the add-on",title:s.name}),await(0,l.E)(),void(0,d.o)(`/hassio/addon/${s.slug}/logs`,{replace:!0})}}if("startup"===s.state)return this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",void(this._fetchDataTimeout=window.setTimeout(()=>{this._fetchData(t)},500));if("started"===s.state){this._loadingMessage=void 0,this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0);try{i=await e}catch(a){return this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),await(0,g.K$)(this,{text:this.supervisor.localize("ingress.error_creating_session")||"Unable to create an Ingress session",title:s.name}),await(0,l.E)(),void(0,d.O)()}this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=window.setInterval(async()=>{try{await(0,u.k)(this.hass,i)}catch(a){i=await(0,u.q)(this.hass)}},6e4),this._addon=s}}async _checkLoaded(t){this._addon&&"502: Bad Gateway"===t.target.contentDocument.body.textContent&&(await this.updateComplete,(0,g.dk)(this,{text:this.supervisor.localize("ingress.error_addon_not_ready")||"The add-on seems to not be ready, it might still be starting. Do you want to try again?",title:this._addon.name,confirmText:this.supervisor.localize("ingress.retry")||"Retry",dismissText:this.supervisor.localize("common.no")||"No",confirm:async()=>{const t=this._addon;this._addon=void 0,await Promise.all([this.updateComplete,new Promise(t=>{setTimeout(t,500)})]),this._addon=t}}))}_toggleMenu(){(0,n.r)(this,"hass-toggle-menu")}constructor(...t){super(...t),this.ingressPanel=!1,this.narrow=!1}}T.styles=(0,o.AH)($||($=x`iframe{display:block;width:100%;height:100%;border:0}.header+iframe{height:calc(100% - 40px)}.header{display:flex;align-items:center;font-size:var(--ha-font-size-l);height:40px;padding:0 16px;pointer-events:none;background-color:var(--app-header-background-color);font-weight:var(--ha-font-weight-normal);color:var(--app-header-text-color,#fff);border-bottom:var(--app-header-border-bottom,none);box-sizing:border-box;--mdc-icon-size:20px}.main-title{margin:var(--margin-title);line-height:var(--ha-line-height-condensed);flex-grow:1}ha-icon-button{pointer-events:auto}hass-subpage{--app-header-background-color:var(--sidebar-background-color);--app-header-text-color:var(--sidebar-text-color);--app-header-border-bottom:1px solid var(--divider-color)}`)),(0,a.__decorate)([(0,r.MZ)({attribute:!1})],T.prototype,"hass",void 0),(0,a.__decorate)([(0,r.MZ)({attribute:!1})],T.prototype,"supervisor",void 0),(0,a.__decorate)([(0,r.MZ)({attribute:!1})],T.prototype,"route",void 0),(0,a.__decorate)([(0,r.MZ)({attribute:!1})],T.prototype,"ingressPanel",void 0),(0,a.__decorate)([(0,r.MZ)({type:Boolean})],T.prototype,"narrow",void 0),(0,a.__decorate)([(0,r.wk)()],T.prototype,"_addon",void 0),(0,a.__decorate)([(0,r.wk)()],T.prototype,"_loadingMessage",void 0),T=(0,a.__decorate)([(0,r.EM)("hassio-ingress-view")],T),i()}catch(m){i(m)}})},94372:function(t,e,s){s.d(e,{KH:function(){return r},p9:function(){return o},px:function(){return a}});s(35748),s(65315),s(22416),s(67579),s(47849),s(79566),s(95013),s(13484),s(81071),s(92714),s(55885);var i=s(63182);const a=()=>{const t={},e=new URLSearchParams(i.G.location.search);for(const[s,i]of e.entries())t[s]=i;return t},o=t=>new URLSearchParams(i.G.location.search).get(t),r=t=>{const e=new URLSearchParams;return Object.entries(t).forEach(([t,s])=>{e.append(t,s)}),e.toString()}},51973:function(t,e,s){s.d(e,{k:function(){return r},q:function(){return o}});s(5934);var i=s(99106);function a(t){return document.cookie=`ingress_session=${t};path=/api/hassio_ingress/;SameSite=Strict${"https:"===location.protocol?";Secure":""}`,t}const o=async t=>{if((0,i.v)(t.config.version,2021,2,4)){return a((await t.callWS({type:"supervisor/api",endpoint:"/ingress/session",method:"post"})).session)}return a((await t.callApi("POST","hassio/ingress/session")).data.session)},r=async(t,e)=>{(0,i.v)(t.config.version,2021,2,4)?await t.callWS({type:"supervisor/api",endpoint:"/ingress/validate_session",method:"post",data:{session:e}}):await t.callApi("POST","hassio/ingress/validate_session",{session:e})}}}]);
//# sourceMappingURL=779.5996cac8cf4ed502.js.map