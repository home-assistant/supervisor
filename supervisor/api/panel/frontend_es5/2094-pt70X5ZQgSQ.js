"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[2094],{72094:function(e,t,r){r.r(t);var n=r(99312),s=r(81043),a=r(88962),i=r(33368),o=r(71650),c=r(82390),u=r(69205),d=r(70906),h=r(91808),l=r(34541),p=r(47838),v=r(68144),f=r(79932),x=r(47181),b=r(83849),k=r(15493),_=r(96151),g=(r(5666),r(34154)),m=r(41682),y=r(63864);function Z(e){return document.cookie="ingress_session=".concat(e,";path=/api/hassio_ingress/;SameSite=Strict").concat("https:"===location.protocol?";Secure":""),e}var w,z,T,D,S,A,C=function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.I)(t.config.version,2021,2,4)){e.next=5;break}return e.next=3,t.callWS({type:"supervisor/api",endpoint:"/ingress/session",method:"post"});case 3:return r=e.sent,e.abrupt("return",Z(r.session));case 5:return e.next=7,t.callApi("POST","hassio/ingress/session");case 7:return s=e.sent,e.abrupt("return",Z(s.data.session));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.I)(t.config.version,2021,2,4)){e.next=4;break}return e.next=3,t.callWS({type:"supervisor/api",endpoint:"/ingress/validate_session",method:"post",data:{session:r}});case 3:return e.abrupt("return");case 4:return e.next=6,t.callApi("POST","hassio/ingress/validate_session",{session:r});case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),K=r(26765);r(15291),r(15803),(0,h.Z)([(0,f.Mo)("hassio-ingress-view")],(function(e,t){var r,h,y=function(t){(0,u.Z)(n,t);var r=(0,d.Z)(n);function n(){var t;(0,o.Z)(this,n);for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return t=r.call.apply(r,[this].concat(a)),e((0,c.Z)(t)),t}return(0,i.Z)(n)}(t);return{F:y,d:[{kind:"field",decorators:[(0,f.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,f.Cb)({attribute:!1})],key:"supervisor",value:void 0},{kind:"field",decorators:[(0,f.Cb)()],key:"route",value:void 0},{kind:"field",decorators:[(0,f.Cb)()],key:"ingressPanel",value:function(){return!1}},{kind:"field",decorators:[(0,f.SB)()],key:"_addon",value:void 0},{kind:"field",decorators:[(0,f.Cb)({type:Boolean})],key:"narrow",value:function(){return!1}},{kind:"field",key:"_sessionKeepAlive",value:void 0},{kind:"field",key:"_fetchDataTimeout",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,l.Z)((0,p.Z)(y.prototype),"disconnectedCallback",this).call(this),this._sessionKeepAlive&&(clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=void 0),this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0)}},{kind:"method",key:"render",value:function(){if(!this._addon)return(0,v.dy)(w||(w=(0,a.Z)(["<hass-loading-screen></hass-loading-screen>"])));var e=(0,v.dy)(z||(z=(0,a.Z)(['<iframe title="','" src="','" @load="','"> </iframe>'])),this._addon.name,this._addon.ingress_url,this._checkLoaded);return this.ingressPanel?(0,v.dy)(D||(D=(0,a.Z)(["",""])),this.narrow||"always_hidden"===this.hass.dockedSidebar?(0,v.dy)(S||(S=(0,a.Z)(['<div class="header"> <ha-icon-button .label="','" .path="','" @click="','"></ha-icon-button> <div class="main-title">',"</div> </div> ",""])),this.hass.localize("ui.sidebar.sidebar_toggle"),"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z",this._toggleMenu,this._addon.name,e):e):(0,v.dy)(T||(T=(0,a.Z)(['<hass-subpage .hass="','" .header="','" .narrow="','"> '," </hass-subpage>"])),this.hass,this._addon.name,this.narrow,e)}},{kind:"method",key:"firstUpdated",value:(h=(0,s.Z)((0,n.Z)().mark((function e(){var t,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.route.path){e.next=34;break}if(!(t=(0,k.io)("addon"))){e.next=34;break}return e.prev=3,e.next=6,(0,g.AD)(this.hass,t);case 6:r=e.sent,e.next=17;break;case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,(0,K.Ys)(this,{text:(0,m.js)(e.t0),title:t});case 13:return e.next=15,(0,_.y)();case 15:return(0,b.c)("/hassio/store",{replace:!0}),e.abrupt("return");case 17:if(r.version){e.next=25;break}return e.next=20,(0,K.Ys)(this,{text:this.supervisor.localize("my.error_addon_not_installed"),title:r.name});case 20:return e.next=22,(0,_.y)();case 22:(0,b.c)("/hassio/addon/".concat(r.slug,"/info"),{replace:!0}),e.next=34;break;case 25:if(r.ingress){e.next=33;break}return e.next=28,(0,K.Ys)(this,{text:this.supervisor.localize("my.error_addon_no_ingress"),title:r.name});case 28:return e.next=30,(0,_.y)();case 30:(0,b.c)("/hassio/addon/".concat(r.slug,"/info"),{replace:!0}),e.next=34;break;case 33:(0,b.c)("/hassio/ingress/".concat(r.slug),{replace:!0});case 34:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return h.apply(this,arguments)})},{kind:"method",key:"updated",value:function(e){if((0,l.Z)((0,p.Z)(y.prototype),"updated",this).call(this,e),e.has("route")){var t=this.route.path.substring(1),r=e.get("route"),n=r?r.path.substring(1):void 0;t&&t!==n&&this._fetchData(t)}}},{kind:"method",key:"_fetchData",value:(r=(0,s.Z)((0,n.Z)().mark((function e(t){var r,a,i,o=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=C(this.hass),e.prev=1,e.next=4,(0,g.AD)(this.hass,t);case 4:a=e.sent,e.next=15;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,(0,K.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_info"),title:"Supervisor"});case 11:return e.next=13,(0,_.y)();case 13:return(0,b.c)("/hassio/store",{replace:!0}),e.abrupt("return");case 15:if(a.version){e.next=22;break}return e.next=18,(0,K.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_not_installed"),title:a.name});case 18:return e.next=20,(0,_.y)();case 20:return(0,b.c)("/hassio/addon/".concat(a.slug,"/info"),{replace:!0}),e.abrupt("return");case 22:if(a.ingress_url){e.next=29;break}return e.next=25,(0,K.Ys)(this,{text:this.supervisor.localize("ingress.error_addon_not_supported"),title:a.name});case 25:return e.next=27,(0,_.y)();case 27:return history.back(),e.abrupt("return");case 29:if(a.state&&["startup","started"].includes(a.state)){e.next=56;break}return e.next=32,(0,K.g7)(this,{text:this.supervisor.localize("ingress.error_addon_not_running"),title:a.name,confirmText:this.supervisor.localize("ingress.start_addon"),dismissText:this.supervisor.localize("common.no")});case 32:if(!e.sent){e.next=52;break}return e.prev=34,e.next=37,(0,g.kP)(this.hass,t);case 37:return(0,x.B)(this,"supervisor-collection-refresh",{collection:"addon"}),this._fetchData(t),e.abrupt("return");case 42:return e.prev=42,e.t1=e.catch(34),e.next=46,(0,K.Ys)(this,{text:this.supervisor.localize("ingress.error_starting_addon"),title:a.name});case 46:return e.next=48,(0,_.y)();case 48:return(0,b.c)("/hassio/addon/".concat(a.slug,"/logs"),{replace:!0}),e.abrupt("return");case 50:e.next=56;break;case 52:return e.next=54,(0,_.y)();case 54:return(0,b.c)("/hassio/addon/".concat(a.slug,"/info"),{replace:!0}),e.abrupt("return");case 56:if("startup"!==a.state){e.next=59;break}return this._fetchDataTimeout=window.setTimeout((function(){o._fetchData(t)}),500),e.abrupt("return");case 59:if("started"===a.state){e.next=61;break}return e.abrupt("return");case 61:return this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0),e.prev=62,e.next=65,r;case 65:i=e.sent,e.next=77;break;case 68:return e.prev=68,e.t2=e.catch(62),this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),e.next=73,(0,K.Ys)(this,{text:this.supervisor.localize("ingress.error_creating_session"),title:a.name});case 73:return e.next=75,(0,_.y)();case 75:return history.back(),e.abrupt("return");case 77:this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=window.setInterval((0,s.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P(o.hass,i);case 3:e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,C(o.hass);case 9:i=e.sent;case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),6e4),this._addon=a;case 80:case"end":return e.stop()}}),e,this,[[1,7],[34,42],[62,68]])}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_checkLoaded",value:function(e){var t,r=this;this._addon&&("502: Bad Gateway"===e.target.contentDocument.body.textContent&&(0,K.g7)(this,{text:this.supervisor.localize("ingress.error_addon_not_ready"),title:this._addon.name,confirmText:this.supervisor.localize("ingress.retry"),dismissText:this.supervisor.localize("common.no"),confirm:(t=(0,s.Z)((0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r._addon,r._addon=void 0,e.next=4,Promise.all([r.updateComplete,new Promise((function(e){setTimeout(e,500)}))]);case 4:r._addon=t;case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}))}},{kind:"method",key:"_toggleMenu",value:function(){(0,x.B)(this,"hass-toggle-menu")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,v.iv)(A||(A=(0,a.Z)(["iframe{display:block;width:100%;height:100%;border:0}.header+iframe{height:calc(100% - 40px)}.header{display:flex;align-items:center;font-size:16px;height:40px;padding:0 16px;pointer-events:none;background-color:var(--app-header-background-color);font-weight:400;color:var(--app-header-text-color,#fff);border-bottom:var(--app-header-border-bottom,none);box-sizing:border-box;--mdc-icon-size:20px}.main-title{margin:0 0 0 24px;line-height:20px;flex-grow:1}ha-icon-button{pointer-events:auto}hass-subpage{--app-header-background-color:var(--sidebar-background-color);--app-header-text-color:var(--sidebar-text-color);--app-header-border-bottom:1px solid var(--divider-color)}"])))}}]}}),v.oi)},15493:function(e,t,r){r.d(t,{Q2:function(){return a},io:function(){return i},ou:function(){return o}});var n=r(62746),s=r(40039),a=function(){var e,t={},r=new URLSearchParams(location.search),a=(0,s.Z)(r.entries());try{for(a.s();!(e=a.n()).done;){var i=(0,n.Z)(e.value,2),o=i[0],c=i[1];t[o]=c}}catch(u){a.e(u)}finally{a.f()}return t},i=function(e){return new URLSearchParams(window.location.search).get(e)},o=function(e){var t=new URLSearchParams;return Object.entries(e).forEach((function(e){var r=(0,n.Z)(e,2),s=r[0],a=r[1];t.append(s,a)})),t.toString()}}}]);
//# sourceMappingURL=2094-pt70X5ZQgSQ.js.map