"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[6623],{96623:function(e,t,r){var n=r(33994),s=r(22858),a=r(64599),i=r(35806),o=r(71008),c=r(62193),u=r(2816),d=r(27927),h=r(35890),l=(r(81027),r(82386),r(95737),r(50693),r(39790),r(66457),r(99019),r(96858),r(50289)),p=r(29818),v=r(34897),f=r(16312),g=r(56932),x=r(61441),k=(r(4169),r(28584)),m=r(26025),_=r(95266);function b(e){return document.cookie="ingress_session=".concat(e,";path=/api/hassio_ingress/;SameSite=Strict").concat("https:"===location.protocol?";Secure":""),e}var y,A,w,T,z,K,M=function(){var e=(0,s.A)((0,n.A)().mark((function e(t){var r,s;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,_.v)(t.config.version,2021,2,4)){e.next=5;break}return e.next=3,t.callWS({type:"supervisor/api",endpoint:"/ingress/session",method:"post"});case 3:return r=e.sent,e.abrupt("return",b(r.session));case 5:return e.next=7,t.callApi("POST","hassio/ingress/session");case 7:return s=e.sent,e.abrupt("return",b(s.data.session));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,s.A)((0,n.A)().mark((function e(t,r){return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,_.v)(t.config.version,2021,2,4)){e.next=4;break}return e.next=3,t.callWS({type:"supervisor/api",endpoint:"/ingress/validate_session",method:"post",data:{session:r}});case 3:return e.abrupt("return");case 4:return e.next=6,t.callApi("POST","hassio/ingress/validate_session",{session:r});case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),S=r(6121);r(96394),r(77980),(0,d.A)([(0,p.EM)("hassio-ingress-view")],(function(e,t){var r,d,_,b=function(t){function r(){var t;(0,o.A)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t=(0,c.A)(this,r,[].concat(s)),e(t),t}return(0,u.A)(r,t),(0,i.A)(r)}(t);return{F:b,d:[{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"supervisor",value:void 0},{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"route",value:void 0},{kind:"field",decorators:[(0,p.MZ)({type:Boolean})],key:"ingressPanel",value:function(){return!1}},{kind:"field",decorators:[(0,p.MZ)({type:Boolean})],key:"narrow",value:function(){return!1}},{kind:"field",decorators:[(0,p.wk)()],key:"_addon",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_loadingMessage",value:void 0},{kind:"field",key:"_sessionKeepAlive",value:void 0},{kind:"field",key:"_fetchDataTimeout",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,h.A)(b,"disconnectedCallback",this,3)([]),this._sessionKeepAlive&&(clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=void 0),this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0)}},{kind:"method",key:"render",value:function(){if(!this._addon)return(0,l.qy)(y||(y=(0,a.A)(['<hass-loading-screen .message="','"></hass-loading-screen>'])),this._loadingMessage);var e=(0,l.qy)(A||(A=(0,a.A)(['<iframe title="','" src="','" @load="','"> </iframe>'])),this._addon.name,this._addon.ingress_url,this._checkLoaded);return this.ingressPanel?(0,l.qy)(T||(T=(0,a.A)(["",""])),this.narrow||"always_hidden"===this.hass.dockedSidebar?(0,l.qy)(z||(z=(0,a.A)(['<div class="header"> <ha-icon-button .label="','" .path="','" @click="','"></ha-icon-button> <div class="main-title">',"</div> </div> ",""])),this.hass.localize("ui.sidebar.sidebar_toggle"),"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z",this._toggleMenu,this._addon.name,e):e):(0,l.qy)(w||(w=(0,a.A)(['<hass-subpage .hass="','" .header="','" .narrow="','"> '," </hass-subpage>"])),this.hass,this._addon.name,this.narrow,e)}},{kind:"method",key:"firstUpdated",value:(_=(0,s.A)((0,n.A)().mark((function e(){var t,r;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.route.path){e.next=34;break}if(!(t=(0,g.p9)("addon"))){e.next=34;break}return e.prev=3,e.next=6,(0,k.wj)(this.hass,t);case 6:r=e.sent,e.next=17;break;case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,(0,S.K$)(this,{text:(0,m.VR)(e.t0),title:t});case 13:return e.next=15,(0,x.E)();case 15:return(0,f.o)("/hassio/store",{replace:!0}),e.abrupt("return");case 17:if(r.version){e.next=25;break}return e.next=20,(0,S.K$)(this,{text:this.supervisor.localize("my.error_addon_not_installed"),title:r.name});case 20:return e.next=22,(0,x.E)();case 22:(0,f.o)("/hassio/addon/".concat(r.slug,"/info"),{replace:!0}),e.next=34;break;case 25:if(r.ingress){e.next=33;break}return e.next=28,(0,S.K$)(this,{text:this.supervisor.localize("my.error_addon_no_ingress"),title:r.name});case 28:return e.next=30,(0,x.E)();case 30:(0,f.o)("/hassio/addon/".concat(r.slug,"/info"),{replace:!0}),e.next=34;break;case 33:(0,f.o)("/hassio/ingress/".concat(r.slug),{replace:!0});case 34:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return _.apply(this,arguments)})},{kind:"method",key:"willUpdate",value:function(e){if((0,h.A)(b,"willUpdate",this,3)([e]),e.has("route")){var t=this.route.path.substring(1),r=e.get("route"),n=r?r.path.substring(1):void 0;t&&t!==n&&(this._loadingMessage=void 0,this._fetchData(t))}}},{kind:"method",key:"_fetchData",value:(d=(0,s.A)((0,n.A)().mark((function e(t){var r,a,i,o=this;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(this.hass),e.prev=1,e.next=4,(0,k.wj)(this.hass,t);case 4:a=e.sent,e.next=17;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,this.updateComplete;case 11:return e.next=13,(0,S.K$)(this,{text:this.supervisor.localize("ingress.error_addon_info")||"Unable to fetch add-on info to start Ingress",title:"Supervisor"});case 13:return e.next=15,(0,x.E)();case 15:return(0,f.o)("/hassio/store",{replace:!0}),e.abrupt("return");case 17:if(a.version){e.next=26;break}return e.next=20,this.updateComplete;case 20:return e.next=22,(0,S.K$)(this,{text:this.supervisor.localize("ingress.error_addon_not_installed")||"The add-on is not installed. Please install it first",title:a.name});case 22:return e.next=24,(0,x.E)();case 24:return(0,f.o)("/hassio/addon/".concat(a.slug,"/info"),{replace:!0}),e.abrupt("return");case 26:if(a.ingress_url){e.next=35;break}return e.next=29,this.updateComplete;case 29:return e.next=31,(0,S.K$)(this,{text:this.supervisor.localize("ingress.error_addon_not_supported")||"This add-on does not support Ingress",title:a.name});case 31:return e.next=33,(0,x.E)();case 33:return history.back(),e.abrupt("return");case 35:if(a.state&&["startup","started"].includes(a.state)){e.next=65;break}return e.next=38,this.updateComplete;case 38:return e.next=40,(0,S.dk)(this,{text:this.supervisor.localize("ingress.error_addon_not_running")||"The add-on is not running. Do you want to start it now?",title:a.name,confirmText:this.supervisor.localize("ingress.start_addon")||"Start add-on",dismissText:this.supervisor.localize("common.no")||"No"});case 40:if(!e.sent){e.next=61;break}return e.prev=42,this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",e.next=46,(0,k.eK)(this.hass,t);case 46:return(0,v.r)(this,"supervisor-collection-refresh",{collection:"addon"}),this._fetchData(t),e.abrupt("return");case 51:return e.prev=51,e.t1=e.catch(42),e.next=55,(0,S.K$)(this,{text:this.supervisor.localize("ingress.error_starting_addon")||"Error starting the add-on",title:a.name});case 55:return e.next=57,(0,x.E)();case 57:return(0,f.o)("/hassio/addon/".concat(a.slug,"/logs"),{replace:!0}),e.abrupt("return");case 59:e.next=65;break;case 61:return e.next=63,(0,x.E)();case 63:return(0,f.o)("/hassio/addon/".concat(a.slug,"/info"),{replace:!0}),e.abrupt("return");case 65:if("startup"!==a.state){e.next=69;break}return this._loadingMessage=this.supervisor.localize("ingress.addon_starting")||"The add-on is starting, this can take some time...",this._fetchDataTimeout=window.setTimeout((function(){o._fetchData(t)}),500),e.abrupt("return");case 69:if("started"===a.state){e.next=71;break}return e.abrupt("return");case 71:return this._loadingMessage=void 0,this._fetchDataTimeout&&(clearInterval(this._fetchDataTimeout),this._fetchDataTimeout=void 0),e.prev=73,e.next=76,r;case 76:i=e.sent,e.next=88;break;case 79:return e.prev=79,e.t2=e.catch(73),this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),e.next=84,(0,S.K$)(this,{text:this.supervisor.localize("ingress.error_creating_session")||"Unable to create an Ingress session",title:a.name});case 84:return e.next=86,(0,x.E)();case 86:return history.back(),e.abrupt("return");case 88:this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive),this._sessionKeepAlive=window.setInterval((0,s.A)((0,n.A)().mark((function e(){return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D(o.hass,i);case 3:e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,M(o.hass);case 9:i=e.sent;case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),6e4),this._addon=a;case 91:case"end":return e.stop()}}),e,this,[[1,7],[42,51],[73,79]])}))),function(e){return d.apply(this,arguments)})},{kind:"method",key:"_checkLoaded",value:(r=(0,s.A)((0,n.A)().mark((function e(t){var r=this;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._addon){e.next=2;break}return e.abrupt("return");case 2:if("502: Bad Gateway"!==t.target.contentDocument.body.textContent){e.next=6;break}return e.next=5,this.updateComplete;case 5:(0,S.dk)(this,{text:this.supervisor.localize("ingress.error_addon_not_ready")||"The add-on seems to not be ready, it might still be starting. Do you want to try again?",title:this._addon.name,confirmText:this.supervisor.localize("ingress.retry")||"Retry",dismissText:this.supervisor.localize("common.no")||"No",confirm:function(){var e=(0,s.A)((0,n.A)().mark((function e(){var t;return(0,n.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r._addon,r._addon=void 0,e.next=4,Promise.all([r.updateComplete,new Promise((function(e){setTimeout(e,500)}))]);case 4:r._addon=t;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_toggleMenu",value:function(){(0,v.r)(this,"hass-toggle-menu")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,l.AH)(K||(K=(0,a.A)(["iframe{display:block;width:100%;height:100%;border:0}.header+iframe{height:calc(100% - 40px)}.header{display:flex;align-items:center;font-size:16px;height:40px;padding:0 16px;pointer-events:none;background-color:var(--app-header-background-color);font-weight:400;color:var(--app-header-text-color,#fff);border-bottom:var(--app-header-border-bottom,none);box-sizing:border-box;--mdc-icon-size:20px}.main-title{margin:var(--margin-title);line-height:20px;flex-grow:1}ha-icon-button{pointer-events:auto}hass-subpage{--app-header-background-color:var(--sidebar-background-color);--app-header-text-color:var(--sidebar-text-color);--app-header-border-bottom:1px solid var(--divider-color)}"])))}}]}}),l.WF)},56932:function(e,t,r){r.d(t,{KH:function(){return c},p9:function(){return o},px:function(){return i}});var n=r(658),s=r(64782),a=(r(64017),r(95737),r(99471),r(39790),r(36016),r(7760),r(99019),r(20529),r(253),r(54846),r(66555),r(96858),r(38389),r(74860),r(71011),r(71174),r(542)),i=function(){var e,t={},r=new URLSearchParams(a.G.location.search),i=(0,s.A)(r.entries());try{for(i.s();!(e=i.n()).done;){var o=(0,n.A)(e.value,2),c=o[0],u=o[1];t[c]=u}}catch(d){i.e(d)}finally{i.f()}return t},o=function(e){return new URLSearchParams(a.G.location.search).get(e)},c=function(e){var t=new URLSearchParams;return Object.entries(e).forEach((function(e){var r=(0,n.A)(e,2),s=r[0],a=r[1];t.append(s,a)})),t.toString()}},99471:function(e,t,r){var n=r(41765),s=r(23476).entries;n({target:"Object",stat:!0},{entries:function(e){return s(e)}})}}]);
//# sourceMappingURL=6623.rkakNTfAXjY.js.map